// =============================
// Prisma 설정
// =============================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL") 
}


// =============================
// 모델 정의 (데이터베이스 테이블 구조)
// =============================

model User {
  id         String    @id @default(uuid()) // 기본키
  email      String    @unique              // 이메일
  name       String                         // 사용자 이름
  password   String                         // 비밀번호
  avatar     String?                        // 프로필 이미지
  hashedRefreshToken String? @map("hashed_refresh_token") // 리프레시 토큰 (해싱됨)
  role       Role      @default(GUEST)      // 사용자 역할 (기본값: GUEST)
  verified   Boolean   @default(false)      // 이메일 인증 여부
  createdAt  DateTime  @default(now())      // 생성 시각
  updatedAt  DateTime  @updatedAt           // 수정 시각

  // 관계 정의
  rooms      Room[]    @relation("HostRooms")      // HOST로서 등록한 숙소들
  bookings   Booking[] @relation("GuestBookings")  // GUEST로서 예약한 내역들
  messages   Message[] @relation("UserMessages")   // 사용자가 보낸 메시지들
}


model Room {
  id            String     @id @default(uuid()) // 방 ID
  title         String                        // 숙소 제목
  description   String                        // 숙소 설명
  country       String                        // 숙소 국가
  city          String                        // 숙소 도시
  rules         String?                       // 숙소 이용 규칙 (선택)
  lat           Float                         // 위도
  lng           Float                         // 경도
  pricePerNight Int                           // 1박당 요금
  createdAt     DateTime   @default(now())    // 생성 시각
  updatedAt     DateTime   @updatedAt         // 수정 시각

  // 관계 정의
  images        Image[]    @relation("RoomImages")
  amenities     Amenity[]  @relation("RoomAmenities")
  bookings      Booking[]                     // 예약 정보 (1:N)
  reviews       Review[]   @relation("RoomReviews") // 리뷰 정보 (1:N)
  hostId        String                         // 호스트의 사용자 ID
  host          User       @relation("HostRooms", fields: [hostId], references: [id])
}


model Booking {
  id          String    @id @default(uuid())       // 예약 ID
  startDate   DateTime                              // 예약 시작일
  endDate     DateTime                              // 예약 종료일
  totalPrice  Int                                   // 총 결제 금액
  status      BookingStatus @default(PENDING)       // 예약 상태
  createdAt   DateTime  @default(now())             // 생성 시각
  updatedAt   DateTime  @updatedAt                  // 수정 시각

  payment     Payment?                              // 결제 정보 (1:1)
  review      Review?                               // 리뷰 (1:1)
  roomId      String
  room        Room      @relation(fields: [roomId], references: [id]) // 예약한 방
  guestId     String
  guest       User      @relation("GuestBookings", fields: [guestId], references: [id]) // 예약한 게스트
}


model Review {
  id         String   @id @default(uuid())             // 리뷰 ID
  rating     Int                                       // 별점 (예: 1~5)
  comment    String?                                   // 리뷰 내용 (선택)
  createdAt  DateTime @default(now())                  // 작성 시각

  bookingId  String   @unique                          // 하나의 예약당 하나의 리뷰만 가능
  booking    Booking  @relation(fields: [bookingId], references: [id]) // 예약 참조
  roomId     String
  room       Room     @relation("RoomReviews", fields: [roomId], references: [id]) // 리뷰가 달린 방
}


model Payment {
  id         String    @id @default(uuid())          // 결제 ID
  amount     Int                                     // 결제 금액
  method     PaymentMethod                           // 결제 방식 (카드, 은행, 페이팔 등)
  status     PaymentStatus @default(PENDING)         // 결제 상태
  createdAt  DateTime  @default(now())               // 결제 시각

  bookingId  String    @unique                       // 하나의 예약당 하나의 결제
  booking    Booking   @relation(fields: [bookingId], references: [id]) // 예약 참조
}


model Message {
  id         String   @id @default(uuid())               // 메시지 ID
  toUserId   String                                      // 받는 사람 (User.id 참조는 아님)
  content    String                                      // 메시지 내용
  timestamp  DateTime @default(now())                    // 전송 시각

  fromUserId String
  fromUser   User     @relation("UserMessages", fields: [fromUserId], references: [id]) // 보낸 사람
}

model Image {
  id        String   @id @default(uuid())
  url       String
  createdAt DateTime @default(now())

  roomId String
  room   Room   @relation("RoomImages", fields: [roomId], references: [id], onDelete: Cascade)
}

model Amenity {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())

  rooms Room[] @relation("RoomAmenities")
}




// =============================
// Enum 정의 (고정된 값 목록)
// =============================

// 사용자 역할
enum Role {
  GUEST   // 일반 사용자 (예약 가능)
  HOST    // 숙소 등록자
  ADMIN   // 관리자
}

// 예약 상태
enum BookingStatus {
  PENDING     // 대기 중
  CONFIRMED   // 확정됨
  CANCELLED   // 취소됨
}

// 결제 상태
enum PaymentStatus {
  PENDING     // 결제 대기 중
  COMPLETED   // 결제 완료
  FAILED      // 결제 실패
}

// 결제 방식
enum PaymentMethod {
  CARD      // 신용/체크카드
  BANK      // 계좌이체
  PAYPAL    // 페이팔 결제
}
